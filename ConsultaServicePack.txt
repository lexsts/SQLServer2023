SELECT        TVM.INSTANCIA INSTANCE, TVM.PRODUCT, TVM.EDITION, TVM.PRODUCT_LEVEL SP_ACTUAL, TPM.SERVICE_PACK SP_AVAILABLE, CASE TPM.SEQ - 1 WHEN 0 THEN 'Atualizado' ELSE 'Desatualizado' END AS STATUS, 
                         len(dbo.fn_StripCharacters(TPM.CUMULATIVE_SEQUENCE, 'a-z0-9 .')) AS [UPDATES/SECURITY], TPM.CUMULATIVE_SEQUENCE
FROM            ADM_BDADOS.dbo.TB_INSTANCE_VERSION_MSSQL AS TVM CROSS JOIN
                         ADM_BDADOS.dbo.TB_PATCHES_MSSQL AS TPM
WHERE        (SUBSTRING(REPLACE(SUBSTRING(TVM.PRODUCT, CHARINDEX('(', TVM.PRODUCT) + 1, CHARINDEX(')', TVM.PRODUCT)), ')', ''),1,4) LIKE SUBSTRING(TPM.BUILD_NUMBER,1,4))
ORDER BY TPM.SERVICE_PACK DESC,TPM.CUMULATIVE_SEQUENCE DESC