USE CS

 

GO

 

USE CS

 

GO

 

SELECT COUNT(IFD.COD_INFO)      PARTIC_TOTAL
     , COUNT(ARQ.COD_AGCT)      PARTIC_JA_PROCESSADO
     , SUM(ISNULL(ARQ.CONTADOR , 0))        TOTAL_LINHAS
FROM DBO.VDNINST_INFO_MEIO  IFD WITH(NOLOCK)
    INNER JOIN VDTDATA_PREG DAT WITH(NOLOCK)
        ON DAT.SIGL_SIST = 'CAC'
       AND DAT.TIPO_PROC = 'BAT'
       AND DAT.TIPO_DATA = 'D+0'
    LEFT JOIN (
                SELECT COUNT(1) CONTADOR, ACS.COD_AGCT , ACS.NOME_ARQ
                FROM DBO.ACSARQ_BAT_MOVI_SALD ACS WITH(NOLOCK)
                WHERE ACS.NOME_ARQ = 'CMVD'
                GROUP BY ACS.COD_AGCT , ACS.NOME_ARQ
                ) ARQ
                ON ARQ.COD_AGCT = IFD.COD_INST
               AND ARQ.NOME_ARQ = IFD.COD_INFO
WHERE IFD.COD_INFO  = 'CMVD'
  AND DAT.DATA_PREG BETWEEN IFD.DATA_INIC_EMIS_INFO AND IFD.DATA_FIM_EMIS_INFO

 

SELECT IFD.COD_INST, COUNT(ACS.COD_AGCT) CONTADOR
FROM DBO.VDNINST_INFO_MEIO              IFD WITH(NOLOCK)
    LEFT JOIN DBO.ACSARQ_BAT_MOVI_SALD  ACS WITH(NOLOCK)
        ON IFD.COD_INFO = ACS.NOME_ARQ
       AND IFD.COD_INST = ACS.COD_AGCT
WHERE IFD.COD_INFO = 'CMVD'
GROUP BY IFD.COD_INST
ORDER BY IFD.COD_INST DESC